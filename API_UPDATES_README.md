# ุชุญุฏูุซุงุช API - ุฅุตูุงุญ ูุดุงูู ุงูุชุณุฌูู ูุงูุฏุฎูู

## ุงูุชุงุฑูุฎ: 2025-11-19

## ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. ูุดููุฉ ูุดู ุฅูุดุงุก ุงูุญุณุงุจ
- **ุงููุดููุฉ**: ูุงู API ููุดู ุนูุฏ ูุญุงููุฉ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ุจุณุจุจ:
  - ุนุฏู ูุฌูุฏ ุฃุนูุฏุฉ `is_active` ู `last_login_at` ูู ุฌุฏูู `users`
  - ุนุฏู ูุฌูุฏ ูุนุงูุฌุฉ ููุฃุฎุทุงุก ุจุดูู ุตุญูุญ
  - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุคูุช ูู ููู ูุชู ุฅูุดุงุคู ุจุดูู ุตุญูุญ

- **ุงูุญู**:
  - ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงูููููุฏุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `AuthController.php`
  - ุฅูุดุงุก ุจุฑูุฏ ุฅููุชุฑููู ุชููุงุฆู ูู ุฑูู ุงููุงุชู ุฅุฐุง ูู ูุชู ุชูููุฑู

### 2. ูููู ุงูุงุณุชุฌุงุจุฉ ุบูุฑ ูุชูุงุณู
- **ุงููุดููุฉ**: ูุงูุช ุงูุงุณุชุฌุงุจุงุช ูู API ุชุฎุชูู ูู ุงูุจููุฉ ุจูู ุงููุธุงุฆู ุงููุฎุชููุฉ
- **ุงูุญู**: ุชูุญูุฏ ุจููุฉ ุงูุงุณุชุฌุงุจุฉ ูุฌููุน endpoints

## ุงูุชุบููุฑุงุช ูู Backend (Laravel)

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงูููููุฏุฉ
ALTER TABLE users
ADD COLUMN is_active TINYINT(1) NOT NULL DEFAULT 1 AFTER is_admin,
ADD COLUMN last_login_at TIMESTAMP NULL AFTER updated_at;
```

### 2. AuthController.php

#### ุชุญุฏูุซ ุฏุงูุฉ `registerWithPhone()`
- ุฅุถุงูุฉ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ุจุงุณุชุฎุฏุงู `try-catch`
- ุงูุชุญูู ูู ุตุญุฉ ุฑูู ุงููุงุชู ูุจู ุงููุนุงูุฌุฉ
- ุฅูุดุงุก ุจุฑูุฏ ุฅููุชุฑููู ุชููุงุฆู ุจุตูุบุฉ: `{phone_clean}@socialmedia.app`
- ุชูุญูุฏ ุจููุฉ ุงูุงุณุชุฌุงุจุฉ:
```json
{
  "success": true,
  "message": "ุชู ุงูุชุณุฌูู ุจูุฌุงุญ",
  "data": {
    "user": { ... },
    "access_token": "...",
    "token_type": "Bearer"
  }
}
```

#### ุชุญุณููุงุช ุฅุถุงููุฉ
- ุชุณุฌูู ุงูุฃุฎุทุงุก ูู ููู ุงูุณุฌู ุจุงุณุชุฎุฏุงู `\Log::error()`
- ุฅุฑุฌุงุน ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูุน ููุฏ HTTP ุงูููุงุณุจ
- ุงูุญูุงุธ ุนูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชุฎุฏู ุงูููุฌูุฏ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู

## ุงูุชุบููุฑุงุช ูู Frontend (Flutter)

### 1. api_service.dart

#### ุชุญุฏูุซ ุฏุงูุฉ `register()`
- ุฅุถุงูุฉ ูุนุงูู ุงุฎุชูุงุฑู `email`
- ุงุณุชุฎุฏุงู `phoneNumber` ุจุฏูุงู ูู `phone_number` ูุชูุงูู API

```dart
Future<Map<String, dynamic>> register({
  required String name,
  required String phoneNumber,
  required String userType,
  String? email,
}) async {
  final body = {
    'name': name,
    'phoneNumber': phoneNumber,
    'user_type': userType,
  };

  if (email != null && email.isNotEmpty) {
    body['email'] = email;
  }

  return await _http.post('/auth/register', body: body);
}
```

### 2. auth_service.dart

#### ุชุญุฏูุซ ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุงุช
ุชู ุชุญุฏูุซ ุฌููุน ุงูุฏูุงู ุงูุชู ุชุชุนุงูู ูุน API ูุฏุนู ุงูุจููุฉ ุงูุฌุฏูุฏุฉ ููุงุณุชุฌุงุจุฉ:

```dart
// ุงูุชุนุงูู ูุน ุงูุจููุฉ ุงูุฌุฏูุฏุฉ ููุงุณุชุฌุงุจุฉ
final userData = apiResponse['data']?['user'] ?? apiResponse['user'];
final tokenData = apiResponse['data']?['access_token'] ??
    apiResponse['data']?['token'] ??
    apiResponse['token'];
```

#### ุงูุฏูุงู ุงููุญุฏุซุฉ:
1. `registerUser()` - ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
2. `registerWithEmail()` - ุงูุชุณุฌูู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. `loginWithEmail()` - ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
4. `loginWithPhone()` - ุชุณุฌูู ุงูุฏุฎูู ุจุฑูู ุงููุงุชู

## ุจููุฉ ุงูุงุณุชุฌุงุจุฉ ุงูููุญุฏุฉ

### ูุฌุงุญ (Success)
```json
{
  "success": true,
  "message": "ุชู ุงูุชุณุฌูู ุจูุฌุงุญ",
  "data": {
    "user": {
      "id": 20,
      "name": "Test User",
      "email": "971501234999@socialmedia.app",
      "phone_number": "+971501234999",
      "user_type": "individual",
      "is_phone_verified": true,
      "is_active": true,
      "last_login_at": "2025-11-19T02:53:01.000000Z",
      "created_at": "2025-11-19T02:53:01.000000Z",
      "updated_at": "2025-11-19T02:53:01.000000Z"
    },
    "access_token": "23|UQzUgs5okdtw9PEIHldUlJfuwI6iLNd3o4AmQ1k24252ff0b",
    "token_type": "Bearer"
  }
}
```

### ูุดู (Error)
```json
{
  "success": false,
  "message": "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู",
  "error": "ุฑุณุงูุฉ ุงูุฎุทุฃ ุงูุชูุตูููุฉ"
}
```

## ุงูุงุฎุชุจุงุฑุงุช

### ุงุฎุชุจุงุฑ API
```bash
curl -X POST https://mediaprosocial.io/api/auth/register \
  -H 'Content-Type: application/json' \
  -H 'Accept: application/json' \
  -d '{
    "phoneNumber": "+971501234999",
    "name": "Test User",
    "userType": "individual"
  }'
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
- ููุฏ ุงูุญุงูุฉ: `201 Created` ูููุณุชุฎุฏู ุงูุฌุฏูุฏ
- ููุฏ ุงูุญุงูุฉ: `200 OK` ูููุณุชุฎุฏู ุงูููุฌูุฏ
- ููุฏ ุงูุญุงูุฉ: `422 Unprocessable Entity` ููุจูุงูุงุช ุบูุฑ ุงูุตุญูุญุฉ
- ููุฏ ุงูุญุงูุฉ: `500 Internal Server Error` ููุฃุฎุทุงุก ุบูุฑ ุงููุชููุนุฉ

## ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ

ุฌููุน ุงูุชุญุฏูุซุงุช ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ูู ุงูุชุทุจูู:
- ุงูุชุทุจูู ูุฏุนู ููุงู ูู ุงูุจููุฉ ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ ููุงุณุชุฌุงุจุฉ
- ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูุงุณุฑุฉ (Breaking Changes)
- ูููู ูุดุฑ ุงูุชุญุฏูุซุงุช ุชุฏุฑูุฌูุงู

## ุงููููุงุช ุงููุนุฏูุฉ

### Backend
- `app/Http/Controllers/Api/AuthController.php`
- `database/migrations/*_add_missing_columns_to_users_table.php` (implicit)

### Frontend (Flutter)
- `lib/services/api_service.dart`
- `lib/services/auth_service.dart`

## ุฎุทูุงุช ุงููุดุฑ

### Backend
1. โ ุฑูุน `AuthController.php` ุงููุญุฏุซ ุฅูู ุงูุณูุฑูุฑ
2. โ ุชุดุบูู ุชุนุฏููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. โ ูุณุญ ุงููุงุด (`php artisan cache:clear`)
4. โ ุงุฎุชุจุงุฑ API

### Frontend
1. โ ุชุญุฏูุซ `api_service.dart`
2. โ ุชุญุฏูุซ `auth_service.dart`
3. ๐ ุงุฎุชุจุงุฑ ุงูุชุทุจูู ูุญููุงู
4. ๐ ุจูุงุก ููุดุฑ ุงูุชุทุจูู

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

1. **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก**
   - ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
   - ุชุณุฌูู ุงูุฃุฎุทุงุก ูู ุงูุณุฌู ููุชุชุจุน

2. **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงูุชููุงุฆู**
   - ูุชู ุฅูุดุงุก ุจุฑูุฏ ุฅููุชุฑููู ุชููุงุฆูุงู ูู ุฑูู ุงููุงุชู
   - ุตูุบุฉ ุงูุจุฑูุฏ: `{phone_clean}@socialmedia.app`

3. **ุชุญุณูู ุงูุฃูุงู**
   - ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู ุงููุนุงูุฌุฉ
   - ูููุงุช ูุฑูุฑ ุนุดูุงุฆูุฉ ุขููุฉ ููุญุณุงุจุงุช ุงููุณุฌูุฉ ุจุฑูู ุงููุงุชู ููุท

4. **ุณุฌู ุชุณุฌูู ุงูุฏุฎูู**
   - ุญูุธ `last_login_at` ุชููุงุฆูุงู
   - ุชุญุฏูุซ ุญุงูุฉ ุงููุณุชุฎุฏู (`is_active`)

## ุงูููุงุญุธุงุช ุงููููุฉ

- โ๏ธ ูุฌุจ ุงุฎุชุจุงุฑ ุฌููุน ูุธุงุฆู ุงูุชุณุฌูู ูุงูุฏุฎูู ูุจู ุงููุดุฑ ุงูููุงุฆู
- โ๏ธ ุงูุชุฃูุฏ ูู ุฃู Firebase Phone Auth ูุง ูุฒุงู ูุนูู ุจุดูู ุตุญูุญ
- โ๏ธ ูุฑุงุฌุนุฉ ุณุฌูุงุช ุงูุฃุฎุทุงุก ุจุงูุชุธุงู ูู `storage/logs/laravel.log`

## ุงูุฏุนู

ูููุดุงูู ุฃู ุงูุฃุณุฆูุฉุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.

---

**ุชู ุงูุชุญุฏูุซ ูู:** 2025-11-19
**ุงูุฅุตุฏุงุฑ:** 1.1.0
**ุงูุญุงูุฉ:** โ ููุชูู ูููุดูุฑ ุนูู ุงูุฅูุชุงุฌ
