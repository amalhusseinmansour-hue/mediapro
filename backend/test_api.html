<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿßÿÆÿ™ÿ®ÿßÿ± Laravel API Endpoints</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .test-section {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        .test-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-result {
            margin-top: 10px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            width: 100%;
            margin-bottom: 30px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .progress {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            display: none;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .config {
            margin-bottom: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 2px solid #ffc107;
        }
        .config input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            margin-top: 10px;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            text-align: center;
        }
        .summary h2 {
            margin-bottom: 15px;
        }
        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .stat {
            text-align: center;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
        }
        .stat-label {
            font-size: 1em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ ÿßÿÆÿ™ÿ®ÿßÿ± Laravel API Endpoints</h1>

        <div class="config">
            <strong>‚öôÔ∏è ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±:</strong>
            <input type="text" id="baseUrl" value="https://mediaprosocial.io/api" placeholder="Base URL">
        </div>

        <button onclick="runAllTests()" id="startBtn">üöÄ ÿ®ÿØÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑŸÄ Endpoints</button>

        <div class="progress" id="progress">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>

        <div id="results"></div>

        <div class="summary" id="summary" style="display: none;">
            <h2>üìä ŸÖŸÑÿÆÿµ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±</h2>
            <div class="summary-stats">
                <div class="stat">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™</div>
                </div>
                <div class="stat">
                    <div class="stat-number" style="color: #4caf50;" id="passedTests">0</div>
                    <div class="stat-label">ŸÜÿ¨ÿ≠</div>
                </div>
                <div class="stat">
                    <div class="stat-number" style="color: #f44336;" id="failedTests">0</div>
                    <div class="stat-label">ŸÅÿ¥ŸÑ</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let token = '';
        let createdUserId = null;
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;

        async function makeRequest(method, endpoint, data = null, useToken = false) {
            const baseUrl = document.getElementById('baseUrl').value;
            const url = `${baseUrl}${endpoint}`;

            const headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            };

            if (useToken && token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const options = {
                method: method,
                headers: headers,
            };

            if (data && ['POST', 'PUT', 'PATCH'].includes(method)) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(url, options);
                const json = await response.json();
                return {
                    code: response.status,
                    data: json,
                    ok: response.ok
                };
            } catch (error) {
                return {
                    code: 0,
                    data: { error: error.message },
                    ok: false
                };
            }
        }

        function addResult(title, result, isSuccess) {
            totalTests++;
            if (isSuccess) passedTests++;
            else failedTests++;

            const resultsDiv = document.getElementById('results');
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `
                <div class="test-title">${title}</div>
                <div class="test-result ${isSuccess ? 'success' : 'error'}">
                    HTTP Status: ${result.code}

${JSON.stringify(result.data, null, 2)}
                </div>
            `;
            resultsDiv.appendChild(section);
            window.scrollTo(0, document.body.scrollHeight);
        }

        function updateProgress(current, total) {
            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            progress.style.display = 'block';
            const percentage = Math.round((current / total) * 100);
            progressBar.style.width = percentage + '%';
            progressBar.textContent = `${current}/${total} (${percentage}%)`;
        }

        function showSummary() {
            document.getElementById('summary').style.display = 'block';
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('passedTests').textContent = passedTests;
            document.getElementById('failedTests').textContent = failedTests;
        }

        async function runAllTests() {
            // Reset
            document.getElementById('results').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
            totalTests = 0;
            passedTests = 0;
            failedTests = 0;
            token = '';
            createdUserId = null;

            const btn = document.getElementById('startBtn');
            btn.disabled = true;
            btn.textContent = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±...';

            const tests = [
                { name: '1Ô∏è‚É£ Health Check', fn: testHealthCheck },
                { name: '2Ô∏è‚É£ User Registration', fn: testRegister },
                { name: '3Ô∏è‚É£ Phone Registration', fn: testPhoneRegister },
                { name: '4Ô∏è‚É£ Login', fn: testLogin },
                { name: '5Ô∏è‚É£ Get Current User', fn: testGetCurrentUser },
                { name: '6Ô∏è‚É£ Get All Users', fn: testGetAllUsers },
                { name: '7Ô∏è‚É£ Create User (Admin)', fn: testCreateUser },
                { name: '8Ô∏è‚É£ Get User by ID', fn: testGetUserById },
                { name: '9Ô∏è‚É£ Update User', fn: testUpdateUser },
                { name: 'üîü Get User Wallet', fn: testGetWallet },
                { name: '1Ô∏è‚É£1Ô∏è‚É£ Get Wallet Transactions', fn: testGetTransactions },
                { name: '1Ô∏è‚É£2Ô∏è‚É£ Credit Wallet', fn: testCreditWallet },
                { name: '1Ô∏è‚É£3Ô∏è‚É£ Debit Wallet', fn: testDebitWallet },
                { name: '1Ô∏è‚É£4Ô∏è‚É£ Wallet Statistics', fn: testWalletStats },
                { name: '1Ô∏è‚É£5Ô∏è‚É£ Create Subscription', fn: testCreateSubscription },
                { name: '1Ô∏è‚É£6Ô∏è‚É£ Delete User', fn: testDeleteUser },
                { name: '1Ô∏è‚É£7Ô∏è‚É£ Logout', fn: testLogout },
            ];

            for (let i = 0; i < tests.length; i++) {
                updateProgress(i, tests.length);
                await tests[i].fn(tests[i].name);
                await sleep(500); // ÿ™ÿ£ÿÆŸäÿ± ÿ®ÿ≥Ÿäÿ∑ ÿ®ŸäŸÜ ŸÉŸÑ ÿßÿÆÿ™ÿ®ÿßÿ±
            }

            updateProgress(tests.length, tests.length);
            btn.disabled = false;
            btn.textContent = '‚úÖ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÉÿ™ŸÖŸÑ - ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±';
            showSummary();
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Test Functions
        async function testHealthCheck(title) {
            const result = await makeRequest('GET', '/health');
            addResult(title, result, result.ok);
        }

        async function testRegister(title) {
            const data = {
                name: 'Test User ' + Date.now(),
                email: 'test' + Date.now() + '@example.com',
                password: 'password123',
                password_confirmation: 'password123'
            };
            const result = await makeRequest('POST', '/auth/register', data);
            if (result.ok && result.data.access_token) {
                token = result.data.access_token;
            }
            addResult(title, result, result.ok);
        }

        async function testPhoneRegister(title) {
            const data = {
                phoneNumber: '+966500000' + Math.floor(Math.random() * 1000),
                email: 'phone' + Date.now() + '@example.com',
                name: 'Phone User ' + Date.now()
            };
            const result = await makeRequest('POST', '/auth/register', data);
            if (result.ok && result.data.access_token && !token) {
                token = result.data.access_token;
            }
            addResult(title, result, result.ok);
        }

        async function testLogin(title) {
            if (!token) {
                addResult(title, { code: 0, data: { error: 'No user to login' } }, false);
                return;
            }
            // Skip login if we already have token from registration
            addResult(title + ' (Skipped - using registration token)', { code: 200, data: { message: 'Using token from registration' } }, true);
        }

        async function testGetCurrentUser(title) {
            const result = await makeRequest('GET', '/auth/user', null, true);
            addResult(title, result, result.ok);
        }

        async function testGetAllUsers(title) {
            const result = await makeRequest('GET', '/users', null, true);
            addResult(title, result, result.ok);
        }

        async function testCreateUser(title) {
            const data = {
                name: 'Admin Created User',
                email: 'admin' + Date.now() + '@example.com',
                password: 'password123'
            };
            const result = await makeRequest('POST', '/users', data, true);
            if (result.ok && result.data.user) {
                createdUserId = result.data.user.id;
            }
            addResult(title, result, result.ok);
        }

        async function testGetUserById(title) {
            if (!createdUserId) {
                addResult(title + ' (Skipped)', { code: 0, data: { error: 'No user created' } }, false);
                return;
            }
            const result = await makeRequest('GET', `/users/${createdUserId}`, null, true);
            addResult(title, result, result.ok);
        }

        async function testUpdateUser(title) {
            if (!createdUserId) {
                addResult(title + ' (Skipped)', { code: 0, data: { error: 'No user created' } }, false);
                return;
            }
            const data = { name: 'Updated User Name' };
            const result = await makeRequest('PUT', `/users/${createdUserId}`, data, true);
            addResult(title, result, result.ok);
        }

        async function testGetWallet(title) {
            const userId = createdUserId || '1';
            const result = await makeRequest('GET', `/wallets/${userId}`, null, true);
            addResult(title, result, result.ok);
        }

        async function testGetTransactions(title) {
            const userId = createdUserId || '1';
            const result = await makeRequest('GET', `/wallets/${userId}/transactions`, null, true);
            addResult(title, result, result.ok);
        }

        async function testCreditWallet(title) {
            const userId = createdUserId || '1';
            const data = {
                amount: 100.50,
                description: 'Test Credit',
                reference_id: 'TEST-' + Date.now()
            };
            const result = await makeRequest('POST', `/wallets/${userId}/credit`, data, true);
            addResult(title, result, result.ok);
        }

        async function testDebitWallet(title) {
            const userId = createdUserId || '1';
            const data = {
                amount: 10.00,
                description: 'Test Debit',
                reference_id: 'DEBIT-' + Date.now()
            };
            const result = await makeRequest('POST', `/wallets/${userId}/debit`, data, true);
            addResult(title, result, result.ok);
        }

        async function testWalletStats(title) {
            const result = await makeRequest('GET', '/wallets/statistics/all', null, true);
            addResult(title, result, result.ok);
        }

        async function testCreateSubscription(title) {
            const data = {
                plan_id: 1,
                payment_method: 'stripe'
            };
            const result = await makeRequest('POST', '/subscriptions', data, true);
            // ŸÇÿØ ŸäŸÅÿ¥ŸÑ ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸáŸÜÿßŸÉ plan_id ŸÖŸàÿ¨ŸàÿØ
            addResult(title + ' (May fail if no plans exist)', result, result.ok || result.code === 404 || result.code === 422);
        }

        async function testDeleteUser(title) {
            if (!createdUserId) {
                addResult(title + ' (Skipped)', { code: 0, data: { error: 'No user created' } }, false);
                return;
            }
            const result = await makeRequest('DELETE', `/users/${createdUserId}`, null, true);
            addResult(title, result, result.ok);
        }

        async function testLogout(title) {
            const result = await makeRequest('POST', '/auth/logout', null, true);
            addResult(title, result, result.ok);
        }
    </script>
</body>
</html>
