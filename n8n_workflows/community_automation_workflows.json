{
  "name": "Community Automation Master Workflows",
  "description": "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø£ÙˆØªÙˆÙ…ÙŠØ´Ù† Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ 500% Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¬ØªÙ…Ø¹",
  "workflows": [
    {
      "id": "optimize_community_content",
      "name": "ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
      "description": "ØªØ­Ø³ÙŠÙ† Ø£ÙˆØµØ§Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ¥Ø¶Ø§ÙØ© Tags Ø°ÙƒÙŠØ©",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["type", "name", "title", "description", "category"]
        },
        {
          "type": "openai_api",
          "name": "ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØµÙ Ø¨Ù€ AI",
          "model": "gpt-4",
          "prompt": "Ø­Ø³Ù‘Ù† Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙ Ù„Ù€ {{ type }}: {{ description }}. Ø§Ø¬Ø¹Ù„Ù‡ Ø¬Ø°Ø§Ø¨Ø§Ù‹ ÙˆÙ…Ø­Ø³Ù‘Ù†Ø§Ù‹ Ù„Ù€ SEO Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø£ØµÙ„ÙŠ. Ø£Ø¶Ù ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ø°Ø§Øª ØµÙ„Ø© Ø¨Ù€ {{ category }}",
          "max_tokens": 500
        },
        {
          "type": "openai_api",
          "name": "Ø§Ù‚ØªØ±Ø§Ø­ Tags Ø°ÙƒÙŠØ©",
          "model": "gpt-3.5-turbo",
          "prompt": "Ø§Ù‚ØªØ±Ø­ 8-12 tag Ù…Ù†Ø§Ø³Ø¨ Ù„Ù€ {{ type }} ÙÙŠ ÙØ¦Ø© {{ category }} Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰: {{ description }}. Ø§Ù„Ù€ tags ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø´Ø§Ø¦Ø¹Ø© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¨Ø­Ø«",
          "max_tokens": 200
        },
        {
          "type": "function",
          "name": "ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬",
          "code": "return {\n  optimized_description: $json.choices[0].message.content,\n  suggested_tags: $json.choices[0].message.content.split(',').map(t => t.trim())\n}"
        },
        {
          "type": "respond_to_webhook",
          "name": "Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"
        }
      ]
    },
    {
      "id": "moderate_content",
      "name": "ÙØ­Øµ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Content Moderation)",
      "description": "ÙØ­Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø³Ø¨Ø§Ù… ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ÙŠØ¡",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰",
          "input_fields": ["content"]
        },
        {
          "type": "openai_moderation",
          "name": "ÙØ­Øµ OpenAI Moderation",
          "input": "{{ $json.content }}"
        },
        {
          "type": "if_condition",
          "name": "Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©",
          "condition": "{{ $json.results[0].flagged === false }}",
          "true_branch": [
            {
              "type": "function",
              "name": "Ù…Ø­ØªÙˆÙ‰ Ø¢Ù…Ù†",
              "code": "return { is_safe: true, confidence: 1.0 }"
            }
          ],
          "false_branch": [
            {
              "type": "function",
              "name": "Ù…Ø­ØªÙˆÙ‰ Ù…Ø®Ø§Ù„Ù",
              "code": "return { is_safe: false, reasons: $json.results[0].categories, confidence: 0.0 }"
            }
          ]
        },
        {
          "type": "respond_to_webhook",
          "name": "Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©"
        }
      ]
    },
    {
      "id": "get_ai_recommendations",
      "name": "ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ© Ø¨Ø§Ù„Ù€ AI",
      "description": "ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["user_id", "interests", "type"]
        },
        {
          "type": "firebase_query",
          "name": "Ø¬Ù„Ø¨ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
          "collection": "user_behavior",
          "where": [
            ["user_id", "==", "{{ $json.user_id }}"]
          ],
          "orderBy": "timestamp",
          "limit": 50
        },
        {
          "type": "openai_api",
          "name": "ØªØ­Ù„ÙŠÙ„ ÙˆØªÙˆØµÙŠØ© Ø¨Ø§Ù„Ù€ AI",
          "model": "gpt-4",
          "prompt": "Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {{ $json.interests.join(', ') }} ÙˆØ³Ø¬Ù„ Ù†Ø´Ø§Ø·Ù‡ Ø§Ù„Ø£Ø®ÙŠØ±ØŒ Ø£ÙˆØµÙŠ Ø¨Ù€ 20 {{ $json.type }} Ù…Ù†Ø§Ø³Ø¨Ø©. Ø£Ø¹Ø·Ù†ÙŠ IDs ÙÙ‚Ø· ÙƒÙ…ØµÙÙˆÙØ© JSON",
          "max_tokens": 300
        },
        {
          "type": "firebase_batch_query",
          "name": "Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠØ§Øª",
          "collection": "{{ $json.type === 'groups' ? 'community_groups' : 'community_events' }}",
          "ids": "{{ $json.recommendations }}"
        },
        {
          "type": "function",
          "name": "ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù€ Relevance",
          "code": "const items = $json.items;\nconst userInterests = $input.interests;\n\n// Ø­Ø³Ø§Ø¨ relevance score\nconst scored = items.map(item => {\n  let score = 0;\n  const tags = item.tags || [];\n  \n  // ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù€ tags\n  userInterests.forEach(interest => {\n    if (tags.some(tag => tag.toLowerCase().includes(interest.toLowerCase()))) {\n      score += 3;\n    }\n  });\n  \n  // Engagement score\n  score += (item.engagement_score || 0) * 0.1;\n  \n  // Popular items bonus\n  score += (item.members_count || item.attendees_count || 0) * 0.05;\n  \n  return { ...item, relevance_score: score };\n});\n\n// ØªØ±ØªÙŠØ¨\nscored.sort((a, b) => b.relevance_score - a.relevance_score);\n\nreturn {\n  recommendations: scored.slice(0, 20).map(item => item.id)\n};"
        },
        {
          "type": "respond_to_webhook",
          "name": "Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ØªÙˆØµÙŠØ§Øª"
        }
      ]
    },
    {
      "id": "group_created",
      "name": "Automation Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©",
      "description": "ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„Ù†Ù…Ùˆ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",
          "input_fields": ["group_id", "group_name", "creator_id", "is_premium", "category"]
        },
        {
          "type": "parallel_execution",
          "name": "ØªÙ†ÙÙŠØ° Ù…ØªÙˆØ§Ø²ÙŠ",
          "branches": [
            {
              "name": "Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¤Ø³Ø³",
              "steps": [
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.creator_id }}",
                    "type": "group_created",
                    "title": "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹ØªÙƒ!",
                    "body": "Ù…Ø¬Ù…ÙˆØ¹Ø© {{ $json.group_name }} Ø¬Ø§Ù‡Ø²Ø©. Ø§Ø¨Ø¯Ø£ Ø¨Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡!",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "ØªÙˆØµÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù‡ØªÙ…ÙŠÙ†",
              "steps": [
                {
                  "type": "firebase_query",
                  "collection": "users",
                  "where": [
                    ["interests", "array-contains", "{{ $json.category }}"]
                  ],
                  "limit": 100
                },
                {
                  "type": "loop",
                  "name": "Ø¥Ø±Ø³Ø§Ù„ ØªÙˆØµÙŠØ§Øª",
                  "items": "{{ $json.users }}",
                  "steps": [
                    {
                      "type": "firebase_create",
                      "collection": "notifications",
                      "data": {
                        "user_id": "{{ $item.id }}",
                        "type": "group_recommendation",
                        "title": "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¯ ØªÙ‡Ù…Ùƒ!",
                        "body": "{{ $json.group_name }} - Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ {{ $json.category }}",
                        "action_url": "/groups/{{ $json.group_id }}",
                        "created_at": "{{ new Date().toISOString() }}"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "name": "Ø¥Ø¶Ø§ÙØ© Ù„Ù€ Featured Groups (Ø¥Ø°Ø§ Premium)",
              "condition": "{{ $json.is_premium }}",
              "steps": [
                {
                  "type": "firebase_update",
                  "collection": "community_groups",
                  "doc_id": "{{ $json.group_id }}",
                  "data": {
                    "is_featured": true,
                    "featured_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "ØªÙØ¹ÙŠÙ„ Ø­Ù…Ù„Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©",
              "condition": "{{ $json.is_premium }}",
              "steps": [
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.MARKETING_API_URL }}/campaigns/create",
                  "body": {
                    "type": "group_promotion",
                    "target_id": "{{ $json.group_id }}",
                    "budget": 50,
                    "duration_days": 7
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "event_created",
      "name": "Automation Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯Ø«",
      "description": "ØªØ³ÙˆÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¯Ø«",
          "input_fields": ["event_id", "event_title", "organizer_id", "start_time", "is_paid", "category"]
        },
        {
          "type": "parallel_execution",
          "name": "ØªÙ†ÙÙŠØ° Ù…ØªÙˆØ§Ø²ÙŠ",
          "branches": [
            {
              "name": "Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù†Ø¸Ù…",
              "steps": [
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.organizer_id }}",
                    "type": "event_created",
                    "title": "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯Ø«Ùƒ!",
                    "body": "Ø­Ø¯Ø« {{ $json.event_title }} Ø¬Ø§Ù‡Ø². Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØªØ±ÙˆÙŠØ¬!",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù‡ØªÙ…ÙŠÙ†",
              "steps": [
                {
                  "type": "firebase_query",
                  "collection": "users",
                  "where": [
                    ["interests", "array-contains", "{{ $json.category }}"]
                  ],
                  "limit": 200
                },
                {
                  "type": "loop",
                  "name": "Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ§Øª",
                  "items": "{{ $json.users }}",
                  "steps": [
                    {
                      "type": "firebase_create",
                      "collection": "notifications",
                      "data": {
                        "user_id": "{{ $item.id }}",
                        "type": "event_invitation",
                        "title": "Ø­Ø¯Ø« Ù‚Ø¯ ÙŠÙ‡Ù…Ùƒ!",
                        "body": "{{ $json.event_title }} - {{ new Date($json.start_time).toLocaleDateString('ar') }}",
                        "action_url": "/events/{{ $json.event_id }}",
                        "created_at": "{{ new Date().toISOString() }}"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "name": "Ø¬Ø¯ÙˆÙ„Ø© ØªØ°ÙƒÙŠØ±Ø§Øª",
              "steps": [
                {
                  "type": "schedule_job",
                  "name": "ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©",
                  "run_at": "{{ new Date(new Date($json.start_time).getTime() - 24*60*60*1000).toISOString() }}",
                  "workflow": "send_event_reminder",
                  "data": {
                    "event_id": "{{ $json.event_id }}",
                    "reminder_type": "24h_before"
                  }
                },
                {
                  "type": "schedule_job",
                  "name": "ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ 1 Ø³Ø§Ø¹Ø©",
                  "run_at": "{{ new Date(new Date($json.start_time).getTime() - 60*60*1000).toISOString() }}",
                  "workflow": "send_event_reminder",
                  "data": {
                    "event_id": "{{ $json.event_id }}",
                    "reminder_type": "1h_before"
                  }
                }
              ]
            },
            {
              "name": "Ø­Ù…Ù„Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© (Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©)",
              "condition": "{{ $json.is_paid }}",
              "steps": [
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.MARKETING_API_URL }}/campaigns/create",
                  "body": {
                    "type": "event_promotion",
                    "target_id": "{{ $json.event_id }}",
                    "budget": 100,
                    "duration_days": 14
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "member_joined_group",
      "name": "Automation Ø¹Ù†Ø¯ Ø§Ù†Ø¶Ù…Ø§Ù… Ø¹Ø¶Ùˆ",
      "description": "ØªØ±Ø­ÙŠØ¨ ÙˆØªÙØ§Ø¹Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù€ Retention",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["group_id", "group_name", "user_id", "is_premium"]
        },
        {
          "type": "parallel_execution",
          "name": "ØªÙ†ÙÙŠØ° Ù…ØªÙˆØ§Ø²ÙŠ",
          "branches": [
            {
              "name": "Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨",
              "steps": [
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "group_welcome",
                    "title": "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!",
                    "body": "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© {{ $json.group_name }}. Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡!",
                    "action_url": "/groups/{{ $json.group_id }}",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ø­ØªÙˆÙ‰",
              "steps": [
                {
                  "type": "firebase_query",
                  "collection": "community_posts",
                  "where": [
                    ["group_id", "==", "{{ $json.group_id }}"]
                  ],
                  "orderBy": "engagement_score",
                  "limit": 5
                },
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "content_suggestion",
                    "title": "Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø±Ø§Ø¦Ø¬Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",
                    "body": "Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙÙŠ {{ $json.group_name }}",
                    "data": {
                      "suggested_posts": "{{ $json.posts.map(p => p.id) }}"
                    },
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª",
              "steps": [
                {
                  "type": "firebase_update",
                  "collection": "community_groups",
                  "doc_id": "{{ $json.group_id }}",
                  "data": {
                    "engagement_score": "{{ FieldValue.increment(5) }}"
                  }
                }
              ]
            },
            {
              "name": "Upsell Ù„Ù„Ø¹Ø¶ÙˆÙŠØ© Premium (Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† premium)",
              "condition": "{{ !$json.is_premium }}",
              "steps": [
                {
                  "type": "wait",
                  "duration": "7d"
                },
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "premium_upsell",
                    "title": "Ø§Ø±ØªÙ‚Ù Ù„Ø¹Ø¶ÙˆÙŠØ© Premium!",
                    "body": "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ§ Ø­ØµØ±ÙŠØ© ÙÙŠ {{ $json.group_name }}",
                    "action_url": "/groups/{{ $json.group_id }}/upgrade",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "user_registered_event",
      "name": "Automation Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø­Ø¯Ø«",
      "description": "ØªØ£ÙƒÙŠØ¯ ÙˆØªØ°ÙƒÙŠØ±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["event_id", "event_title", "user_id", "start_time"]
        },
        {
          "type": "parallel_execution",
          "name": "ØªÙ†ÙÙŠØ° Ù…ØªÙˆØ§Ø²ÙŠ",
          "branches": [
            {
              "name": "ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
              "steps": [
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "event_confirmation",
                    "title": "ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„!",
                    "body": "ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ {{ $json.event_title }}. Ù†Ø±Ø§Ùƒ Ù‡Ù†Ø§Ùƒ!",
                    "action_url": "/events/{{ $json.event_id }}",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªÙ‚ÙˆÙŠÙ…",
              "steps": [
                {
                  "type": "generate_calendar_invite",
                  "event_title": "{{ $json.event_title }}",
                  "start_time": "{{ $json.start_time }}",
                  "user_email": "{{ $user.email }}"
                }
              ]
            },
            {
              "name": "Ø§Ù‚ØªØ±Ø§Ø­ Ø£Ø­Ø¯Ø§Ø« Ù…Ø´Ø§Ø¨Ù‡Ø©",
              "steps": [
                {
                  "type": "wait",
                  "duration": "3d"
                },
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.N8N_WEBHOOK_URL }}/get_ai_recommendations",
                  "body": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "events",
                    "interests": ["{{ $json.event_category }}"]
                  }
                },
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "event_recommendations",
                    "title": "Ø£Ø­Ø¯Ø§Ø« Ù‚Ø¯ ØªÙ‡Ù…Ùƒ",
                    "body": "Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ø£Ø­Ø¯Ø§Ø« Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù€ {{ $json.event_title }}",
                    "data": {
                      "recommended_events": "{{ $json.recommendations }}"
                    },
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "premium_item_created",
      "name": "Automation Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©",
      "description": "Ø­Ù…Ù„Ø§Øª ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ù…ÙƒØ«ÙØ© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["type", "id", "price"]
        },
        {
          "type": "parallel_execution",
          "name": "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…ÙƒØ«Ù",
          "branches": [
            {
              "name": "Ø­Ù…Ù„Ø© Email Marketing",
              "steps": [
                {
                  "type": "firebase_query",
                  "collection": "users",
                  "where": [
                    ["email_notifications_enabled", "==", true]
                  ],
                  "limit": 1000
                },
                {
                  "type": "send_bulk_email",
                  "template": "premium_item_launch",
                  "recipients": "{{ $json.users.map(u => u.email) }}",
                  "data": {
                    "item_type": "{{ $json.type }}",
                    "item_id": "{{ $json.id }}",
                    "price": "{{ $json.price }}"
                  }
                }
              ]
            },
            {
              "name": "Ø­Ù…Ù„Ø© Push Notifications",
              "steps": [
                {
                  "type": "firebase_query",
                  "collection": "users",
                  "where": [
                    ["push_notifications_enabled", "==", true]
                  ],
                  "limit": 5000
                },
                {
                  "type": "send_bulk_push",
                  "title": "Ø¹Ø±Ø¶ Premium Ø¬Ø¯ÙŠØ¯!",
                  "body": "Ø§ÙƒØªØ´Ù Ø§Ù„Ø¢Ù† Ø¨Ø³Ø¹Ø± {{ $json.price }}",
                  "data": {
                    "type": "{{ $json.type }}",
                    "id": "{{ $json.id }}"
                  }
                }
              ]
            },
            {
              "name": "Ø­Ù…Ù„Ø© Social Media",
              "steps": [
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.SOCIAL_MEDIA_API }}/auto-post",
                  "body": {
                    "platforms": ["twitter", "facebook", "instagram"],
                    "content": "Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†! ğŸš€",
                    "link": "{{ $env.APP_URL }}/{{ $json.type }}/{{ $json.id }}"
                  }
                }
              ]
            },
            {
              "name": "Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø®ØµÙ…",
              "steps": [
                {
                  "type": "function",
                  "name": "Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª",
                  "code": "const coupons = [];\nfor(let i = 0; i < 10; i++) {\n  coupons.push({\n    code: 'PREMIUM' + Math.random().toString(36).substr(2, 8).toUpperCase(),\n    discount: 20,\n    valid_until: new Date(Date.now() + 7*24*60*60*1000).toISOString(),\n    item_type: $json.type,\n    item_id: $json.id\n  });\n}\nreturn { coupons };"
                },
                {
                  "type": "firebase_batch_create",
                  "collection": "coupons",
                  "items": "{{ $json.coupons }}"
                }
              ]
            },
            {
              "name": "A/B Testing Ø§Ù„ØªØ³Ø¹ÙŠØ±",
              "steps": [
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.ANALYTICS_API }}/experiments/create",
                  "body": {
                    "name": "pricing_test_{{ $json.id }}",
                    "variants": [
                      {
                        "name": "original",
                        "price": "{{ $json.price }}"
                      },
                      {
                        "name": "discounted_10",
                        "price": "{{ $json.price * 0.9 }}"
                      },
                      {
                        "name": "discounted_20",
                        "price": "{{ $json.price * 0.8 }}"
                      }
                    ]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "revenue_generated",
      "name": "Automation Ø¹Ù†Ø¯ ØªÙˆÙ„ÙŠØ¯ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
      "description": "ØªØ­ÙÙŠØ² Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Upsell",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
          "input_fields": ["type", "amount", "user_id"]
        },
        {
          "type": "parallel_execution",
          "name": "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡",
          "branches": [
            {
              "name": "Ø´ÙƒØ± Ø§Ù„Ø¹Ù…ÙŠÙ„",
              "steps": [
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "thank_you",
                    "title": "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¯Ø¹Ù…Ùƒ! ğŸ’™",
                    "body": "Ù†Ù‚Ø¯Ø± Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø­ØµØ±ÙŠØ©!",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "Ù…Ù†Ø­ Ù†Ù‚Ø§Ø· Ù…ÙƒØ§ÙØ£Ø©",
              "steps": [
                {
                  "type": "firebase_update",
                  "collection": "users",
                  "doc_id": "{{ $json.user_id }}",
                  "data": {
                    "loyalty_points": "{{ FieldValue.increment(Math.floor($json.amount * 10)) }}"
                  }
                }
              ]
            },
            {
              "name": "Upsell / Cross-sell",
              "steps": [
                {
                  "type": "wait",
                  "duration": "2d"
                },
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.N8N_WEBHOOK_URL }}/get_ai_recommendations",
                  "body": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "premium_items",
                    "context": "post_purchase"
                  }
                },
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "premium_recommendations",
                    "title": "Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ© Ù„Ùƒ!",
                    "body": "Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù…ÙŠØ²",
                    "data": {
                      "recommendations": "{{ $json.recommendations }}"
                    },
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "Ø·Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… / Ù…Ø±Ø§Ø¬Ø¹Ø©",
              "steps": [
                {
                  "type": "wait",
                  "duration": "5d"
                },
                {
                  "type": "firebase_create",
                  "collection": "notifications",
                  "data": {
                    "user_id": "{{ $json.user_id }}",
                    "type": "review_request",
                    "title": "Ù…Ø§ Ø±Ø£ÙŠÙƒ ÙÙŠ ØªØ¬Ø±Ø¨ØªÙƒØŸ",
                    "body": "Ù†ÙˆØ¯ Ø³Ù…Ø§Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©",
                    "action_url": "/feedback",
                    "created_at": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            },
            {
              "name": "ØªØ­Ø¯ÙŠØ« Analytics",
              "steps": [
                {
                  "type": "http_request",
                  "method": "POST",
                  "url": "{{ $env.ANALYTICS_API }}/events/track",
                  "body": {
                    "event": "revenue_generated",
                    "user_id": "{{ $json.user_id }}",
                    "amount": "{{ $json.amount }}",
                    "type": "{{ $json.type }}",
                    "timestamp": "{{ new Date().toISOString() }}"
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "analyze_user_behavior",
      "name": "ØªØ­Ù„ÙŠÙ„ Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
      "description": "ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ù€ Engagement",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["user_id", "action"]
        },
        {
          "type": "firebase_query",
          "name": "Ø¬Ù„Ø¨ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·",
          "collection": "user_behavior",
          "where": [
            ["user_id", "==", "{{ $json.user_id }}"]
          ],
          "orderBy": "timestamp",
          "limit": 200
        },
        {
          "type": "openai_api",
          "name": "ØªØ­Ù„ÙŠÙ„ Ø¨Ø§Ù„Ù€ AI",
          "model": "gpt-4",
          "prompt": "Ø­Ù„Ù„ Ø³Ù„ÙˆÙƒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø³ØªÙ†ØªØ¬ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙ‡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†Ø´Ø§Ø·Ù‡: {{ $json.activities.map(a => a.action + ':' + a.target_id).join(', ') }}. Ø£Ø¹Ø·Ù†ÙŠ JSON Ø¨Ø§Ù„ØµÙŠØºØ©: {interests: [], engagement_level: 'low|medium|high', recommended_content_types: [], churn_risk: number}",
          "max_tokens": 500
        },
        {
          "type": "firebase_update",
          "name": "ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
          "collection": "user_activity",
          "doc_id": "{{ $json.user_id }}",
          "data": {
            "inferred_interests": "{{ $json.interests }}",
            "engagement_level": "{{ $json.engagement_level }}",
            "recommended_content_types": "{{ $json.recommended_content_types }}",
            "churn_risk": "{{ $json.churn_risk }}",
            "analyzed_at": "{{ new Date().toISOString() }}"
          }
        },
        {
          "type": "if_condition",
          "name": "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ø±Ø¶ÙŠÙ† Ù„Ù„Ù…ØºØ§Ø¯Ø±Ø©",
          "condition": "{{ $json.churn_risk > 0.7 }}",
          "true_branch": [
            {
              "type": "firebase_create",
              "collection": "notifications",
              "data": {
                "user_id": "{{ $json.user_id }}",
                "type": "retention_campaign",
                "title": "Ø§Ø´ØªÙ‚Ù†Ø§ Ù„Ùƒ! ğŸŒŸ",
                "body": "Ù„Ø¯ÙŠÙƒ Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ ÙˆÙ…Ù…ÙŠØ² ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±Ùƒ",
                "data": {
                  "special_offer": true,
                  "discount_code": "COMEBACK20"
                },
                "created_at": "{{ new Date().toISOString() }}"
              }
            }
          ]
        }
      ]
    },
    {
      "id": "send_push_notification",
      "name": "Ø¥Ø±Ø³Ø§Ù„ Push Notification",
      "description": "Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
      "trigger": "webhook",
      "steps": [
        {
          "type": "webhook_receiver",
          "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          "input_fields": ["user_id", "title", "body", "data"]
        },
        {
          "type": "firebase_query",
          "name": "Ø¬Ù„Ø¨ FCM Token",
          "collection": "users",
          "doc_id": "{{ $json.user_id }}"
        },
        {
          "type": "if_condition",
          "name": "Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
          "condition": "{{ $json.push_notifications_enabled && $json.fcm_token }}",
          "true_branch": [
            {
              "type": "fcm_send",
              "name": "Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± FCM",
              "token": "{{ $json.fcm_token }}",
              "notification": {
                "title": "{{ $input.title }}",
                "body": "{{ $input.body }}"
              },
              "data": "{{ $input.data }}"
            }
          ]
        }
      ]
    }
  ],
  "automation_strategies": {
    "revenue_increase_plan": {
      "description": "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ 500%",
      "tactics": [
        {
          "name": "Premium Content Monetization",
          "description": "ØªØ­ÙˆÙŠÙ„ 30% Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¥Ù„Ù‰ premium",
          "expected_impact": "+150% revenue"
        },
        {
          "name": "Intelligent Upselling",
          "description": "ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø´Ø±Ø§Ø¡ Ù„Ø²ÙŠØ§Ø¯Ø© AOV",
          "expected_impact": "+80% revenue"
        },
        {
          "name": "Retention Automation",
          "description": "ØªÙ‚Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© Ø¨Ù€ 40% Ø¹Ø¨Ø± engagement Ù…Ø®ØµØµ",
          "expected_impact": "+100% revenue"
        },
        {
          "name": "Viral Growth Loops",
          "description": "ØªØ­ÙÙŠØ² Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø¯Ø¹ÙˆØ§Øª Ù…Ø¹ Ù…ÙƒØ§ÙØ¢Øª",
          "expected_impact": "+120% revenue"
        },
        {
          "name": "Dynamic Pricing",
          "description": "ØªØ³Ø¹ÙŠØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ù€ Analytics",
          "expected_impact": "+50% revenue"
        }
      ],
      "total_expected_impact": "+500% revenue"
    }
  }
}
