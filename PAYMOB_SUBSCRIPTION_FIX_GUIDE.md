# ุญู ุดุงูู ููุดููุฉ ุงููุตุงุฏูุฉ ูุน Paymob ูู ุดุงุดุฉ ุงูุงุดุชุฑุงูุงุช

## ููุฎุต ุงููุดููุฉ

```
โ ูุดู ุงููุตุงุฏูุฉ ูุน Paymob
HTTP 403 Forbidden: "incorrect credentials"
ูู ุดุงุดุฉ ุงูุงุดุชุฑุงูุงุช ุนูุฏ ูุญุงููุฉ ุงูุฏูุน
```

## ุงูุณุจุจ ุงูุฌุฐุฑู

ููุชุงุญ Paymob API ูู ููู `lib/core/config/api_config.dart` ุบูุฑ ุตุญูุญ ุฃู ุงูุชูุช ุตูุงุญูุชู.

---

## ุงูุญููู ุงูููุตู ุจูุง

### โ ุงูุญู 1: ุชุญุฏูุซ ููุชุงุญ API (ุงูุฃูุถู)

#### ุงูุฎุทูุฉ 1: ุงูุญุตูู ุนูู ููุชุงุญ ุฌุฏูุฏ ูู Paymob

```bash
# ุฒูุงุฑุฉ:
https://accept.paymob.com/portal2/en/settings

# ุฃู ูุจุงุดุฑุฉ:
https://accept.paymob.com/portal2/en/profile/api-keys

# ุงูุฎุทูุงุช:
1. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจู
2. ุงุฐูุจ ุฅูู "Settings" ุฃู "API Keys"
3. ุงุจุญุซ ุนู "API Key" (ูููุณ Public Key ุฃู Secret Key)
4. ุงูุณุฎ ุงูููุชุงุญ
5. ุฅุฐุง ูุงู ูุฏููุงูุ ุงุถุบุท "Regenerate" ููุญุตูู ุนูู ููุชุงุญ ุฌุฏูุฏ
```

#### ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุงูููุชุงุญ ูู ุงูุชุทุจูู

**ุงูููู:** `lib/core/config/api_config.dart`

```dart
/// OLD (ุบูุฑ ุตุญูุญ):
static const String paymobApiKey = String.fromEnvironment(
  'PAYMOB_API_KEY',
  defaultValue: 'ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5...', 
  // โ ูุฐุง ุงูููุชุงุญ ูุง ูุนูู
);

/// NEW (ุตุญูุญ):
static const String paymobApiKey = String.fromEnvironment(
  'PAYMOB_API_KEY',
  defaultValue: 'YOUR_NEW_API_KEY_FROM_PAYMOB_DASHBOARD',
  // โ ุถุน ุงูููุชุงุญ ุงูุฌุฏูุฏ ููุง
);
```

#### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงูุงุชุตุงู

```bash
# ุดุบู ุงูุชุทุจูู ูุงูุชุญ ุดุงุดุฉ ุงูุงุดุชุฑุงูุงุช
# ุฌุฑุจ ุงูุฏูุน ูุฑุฉ ูุงุญุฏุฉ
# ุชุญูู ูู console output:
โ Paymob: Auth token received  โ ูุฌุญ!
```

---

### โ ุงูุญู 2: ุงุณุชุฎุฏุงู ุฏุงูุฉ ุงูุชุดุฎูุต

ุงุณุชุฎุฏู ุงูุฏุงูุฉ ุงููุฏูุฌุฉ ูุชุญุฏูุฏ ุงููุดููุฉ ุจุฏูุฉ:

#### ูู `main.dart` ุฃู `lib/main.dart`:

```dart
import 'lib/utils/paymob_diagnostic_test.dart';

void main() async {
  // ูุจู ุชุดุบูู ุงูุชุทุจูู ุงูุฑุฆูุณู
  await runPaymobDiagnostics();
  
  // ุซู ุดุบู ุงูุชุทุจูู
  runApp(const MyApp());
}
```

#### ุงูุฅุฎุฑุงุฌ ุงููุชููุน:

```
โ Test Mode: false
๐ API Key Status:
   Length: 145
   Starts with: ZXlKaGJHY2lPaUpJVXpVeE1p...
   Valid format: false โ ุงููุดููุฉ ููุง

โ API Key ุบูุฑ ุตุญูุญ ุฃู ููููุฏ
```

---

### โ ุงูุญู 3: ุชูุนูู ุงููุถุน ุงูุชุฌุฑูุจู (ููุงุฎุชุจุงุฑ ุงูุณุฑูุน)

ุฅุฐุง ููุช ุชุฑูุฏ ุงุฎุชุจุงุฑ ุงูุชุทุจูู ุจุฏูู ููุชุงุญ Paymob ุตุญูุญ:

**ุงูููู:** `lib/core/config/api_config.dart`

```dart
/// ุชูุนูู ุงููุถุน ุงูุชุฌุฑูุจู:
static const bool enableTestMode = String.fromEnvironment(
  'PAYMOB_TEST_MODE',
  defaultValue: 'true',  // โ ุบููุฑ ุฅูู 'true'
);
```

**ุงููุชูุฌุฉ:**
- ุงูุชุทุจูู ุณูุญุงูู ุนูููุงุช ุงูุฏูุน ูุญููุงู
- ูุง ูุชุทูุจ ููุชุงุญ Paymob ุตุญูุญ
- ููุงุณุจ ููุงุฎุชุจุงุฑ ูุงูุชุทููุฑ ููุท

---

## ุฎุทูุงุช ุงูุชุดุฎูุต ุงููุชูุฏูุฉ

### 1. ุงูุชุญูู ูู ุตูุบุฉ ุงูููุชุงุญ

```dart
// ูู ุฃู ููุงู ูู ุงูุชุทุจูู:
final apiKey = ApiConfig.paymobApiKey;
print('API Key length: ${apiKey.length}');  // ูุฌุจ > 50
print('Is valid: ${ApiConfig.isValidApiKey(apiKey)}');
```

### 2. ุงูุญุตูู ุนูู ูุนูููุงุช ููุตูุฉ

```dart
// ุดุบู ุงูุชุดุฎูุต ุงููุงูู:
final paymobService = PaymobService();
final result = await paymobService.diagnosePaymobConnection();
print(result);  // ูุนูููุงุช ูุงููุฉ
```

### 3. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ูุจุงุดุฑุฉ

```dart
// ุงุฎุชุจุฑ ุงููุตุงุฏูุฉ ููุท:
final paymobService = PaymobService();
final token = await paymobService.getAuthToken();

if (token != null) {
  print('โ ูุฌุญ ุงูุงุชุตุงู');
} else {
  print('โ ูุดู ุงูุงุชุตุงู - ุชุญูู ูู API Key');
}
```

---

## ูุนูููุงุช ุญุณุงุจ Paymob ุงูุญุงูู

```
Email: [ูู ุญุณุงุจู]
Account Status: ุชู ุฅูุดุงุคู: 26 ุฃูุชูุจุฑ 2025
HMAC Secret: BA095DD5F6DADC3FF2D6C9BE9E8CFB8C

Integration IDs (ุทุฑู ุงูุฏูุน):
โโ 81249: MIGS-online (ุจุทุงูุงุช ุงุฆุชูุงู - Live)
โโ 81250: MIGS-onlineAmex (ุจุทุงูุงุช ุฃูุฑููุงู ุฅูุณุจุฑูุณ - Live)

Iframe IDs (ุตูุญุงุช ุงูุฏูุน):
โโ 81249: Default Payment Page

ุงูุฑุงุจุท ุงูุฃุณุงุณู: https://accept.paymob.com/api
ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ: AED (ุฏุฑูู ุฅูุงุฑุงุชู)
```

---

## ุงููููุงุช ุงููุชุฃุซุฑุฉ

| ุงูููู | ุงูุฏูุฑ |
|------|------|
| `lib/core/config/api_config.dart` | **ุชูููู ููุงุชูุญ API** - ูุญุชูู ุนูู ููุชุงุญ Paymob |
| `lib/services/paymob_service.dart` | **ุฎุฏูุฉ ุงูุฏูุน** - ุชุณุชุฎุฏู ุงูููุชุงุญ ูููุตุงุฏูุฉ |
| `lib/screens/subscription/subscription_screen.dart` | **ุดุงุดุฉ ุงูุงุดุชุฑุงูุงุช** - ุชุณุชุฏุนู ุฎุฏูุฉ ุงูุฏูุน |
| `lib/core/config/paymob_config.dart` | ุฅุนุฏุงุฏุงุช Paymob ุงูุฅุถุงููุฉ |
| `lib/utils/paymob_diagnostic_test.dart` | **ุฃุฏุงุฉ ุงูุชุดุฎูุต** - ุฌุฏูุฏ |

---

## ุฎุทูุงุช ุงูุฅุตูุงุญ ุงูุณุฑูุนุฉ

```
1๏ธโฃ  ุงุฐูุจ ุฅูู https://accept.paymob.com/portal2/en/settings
2๏ธโฃ  ุงูุณุฎ API Key ุงูุตุญูุญ
3๏ธโฃ  ุงูุชุญ lib/core/config/api_config.dart
4๏ธโฃ  ุญุฏูุซ paymobApiKey ุจุงูููุชุงุญ ุงูุฌุฏูุฏ
5๏ธโฃ  ุงุญูุธ ุงูููู
6๏ธโฃ  ุดุบูู ุงูุชุทุจูู
7๏ธโฃ  ุฌุฑูุจ ุงูุฏูุน ูุฑุฉ ูุงุญุฏุฉ
8๏ธโฃ  ุชุญูู ูู console ููุชุฃูุฏ
```

---

## ููููุฉ ููู ุฑุณุงุฆู ุงูุฎุทุฃ

### 403 Forbidden - "incorrect credentials"
```
ุงูุณุจุจ: ููุชุงุญ API ุบูุฑ ุตุญูุญ
ุงูุญู: ุชุญุฏูุซ ุงูููุชุงุญ ูู ููุญุฉ ุงูุชุญูู
```

### 400 Bad Request
```
ุงูุณุจุจ: ุตูุบุฉ ุงูุทูุจ ุบูุฑ ุตุญูุญุฉ
ุงูุญู: ุชุญูู ูู ุตูุบุฉ ุงูููุชุงุญ ูุงูุจูุงูุงุช
```

### 401 Unauthorized
```
ุงูุณุจุจ: ุงูููุชุงุญ ููุชูู ุงูุตูุงุญูุฉ ุฃู ูุง ุชูุฌุฏ ุตูุงุญูุงุช
ุงูุญู: ุฌุฑุจ Regenerate ูู Paymob
```

### Connection Timeout
```
ุงูุณุจุจ: ุงุชุตุงู ุจุทูุก ุฃู Paymob ุบูุฑ ูุชุงุญ
ุงูุญู: ุชุญูู ูู ุงูุฅูุชุฑูุช ูุญุงูุฉ ุฎูุงุฏู Paymob
```

---

## ูุตุงุฆุญ ูููุฉ

๐ **ุงูุฃูุงู:**
- ูุง ุชุถุน ููุงุชูุญ ุญููููุฉ ูู `defaultValue`
- ุงุณุชุฎุฏู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู ุงูุฅูุชุงุฌ
- ุฃุถู `.env` ุฅูู `.gitignore`

โก **ุงูุฃุฏุงุก:**
- ุงููุตุงุฏูุฉ ุชุญุฏุซ ูุฑุฉ ูุงุญุฏุฉ ููู ุนูููุฉ ุฏูุน
- ุงูุฑูุฒ (Token) ูุตูุญ 1 ุณุงุนุฉ ููุท
- ูุง ุชุฎุฒูู ุงูุฑููุฒ ุจุดูู ุฏุงุฆู

โ **ุฃูุถู ุงูููุงุฑุณุงุช:**
- ุงุฎุชุจุฑ ูู ุงููุถุน ุงูุชุฌุฑูุจู ุฃููุงู
- ุงุณุชุฎุฏู ุจูุงูุงุช ุงุฎุชุจุงุฑ ูู Paymob
- ุฑุงูุจ logs ูู console
- ุงุณุชุฎุฏู ุฃุฏุงุฉ ุงูุชุดุฎูุต ุนูุฏ ุงูุญุงุฌุฉ

---

## ุงููุฑุงุฌุน

| ุงูููุถูุน | ุงูุฑุงุจุท |
|---------|--------|
| ููุญุฉ ุชุญูู Paymob | https://accept.paymob.com/portal2 |
| ุฅุนุฏุงุฏุงุช API | https://accept.paymob.com/portal2/en/settings |
| ููุงุชูุญ API | https://accept.paymob.com/portal2/en/profile/api-keys |
| ุชูุซูู Paymob | https://docs.paymob.com |
| ุฏุนู Paymob | support@paymob.com |

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โณ **ุชุญุฏูุซ ุงูููุชุงุญ** - ุงุญุตู ุนูู ููุชุงุญ ุฌุฏูุฏ ูู Paymob
2. โณ **ุชุญุฏูุซ ุงูููู** - ุญุฏูุซ `api_config.dart`
3. โณ **ุงูุงุฎุชุจุงุฑ** - ุดุบูู ุงูุชุทุจูู ูุฌุฑูุจ ุงูุงุดุชุฑุงู
4. โ **ุงูุชุญูู** - ุชุฃูุฏ ูู ุฅููุงู ุงูุฏูุน ุจูุฌุงุญ

---

**ุขุฎุฑ ุชุญุฏูุซ:** ููุงูุฑ 20ุ 2025
**ุงูุญุงูุฉ:** ูู ุงูุชุทูุฑ - ููุชุธุฑ ุชุญุฏูุซ ููุชุงุญ API
