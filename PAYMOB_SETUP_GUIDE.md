# ุฏููู ุฅุนุฏุงุฏ Paymob Payment Gateway

## ุงููุดููุฉ ุงูุญุงููุฉ

API Key ุงูุญุงูู ููุฑุฌุน ุฎุทุฃ **403 Forbidden** ูุน ุงูุฑุณุงูุฉ `"incorrect credentials"`.

ูุฐุง ูุนูู ุฃู ุงูููุชุงุญ:
- ููุชูู ุงูุตูุงุญูุฉ
- ุบูุฑ ุตุญูุญ
- ุฃู ุงูุญุณุงุจ ูุญุชุงุฌ ุชูุนูู ุฅุถุงูู

---

## ุงูุญู ุงููุคูุช (ุงููุถุน ุงูุชุฌุฑูุจู)

ุชู ุชูุนูู **ูุถุน ุงูุฏูุน ุงูุชุฌุฑูุจู** (Test Mode) ูุคูุชุงู ูู ุงูุชุทุจูู.

### ููู ูุนูู ุงููุถุน ุงูุชุฌุฑูุจูุ

- ูุญุงูู ุนูููุฉ ุฏูุน ูุงุฌุญุฉ ุจุฏูู ุงูุญุงุฌุฉ ูู Paymob API
- ูุชูุญ ูู ุงุฎุชุจุงุฑ ุฌููุน ูุธุงุฆู ุงูุงุดุชุฑุงู
- ูุนุฑุถ Order ID ูููู ูุฃุบุฑุงุถ ุงูุชุชุจุน
- **ูุง ูุชู ุฎุตู ุฃููุงู ุญููููุฉ**

### ูุชุนุทูู ุงููุถุน ุงูุชุฌุฑูุจู:

ุงูุชุญ ุงูููู `lib/core/config/api_config.dart` ูุบููุฑ:

```dart
static const bool enableTestMode = true; // ุบููุฑูุง ุฅูู false
```

---

## ุฎุทูุงุช ุงูุญุตูู ุนูู API Key ุงูุตุญูุญ

### 1. ุชุณุฌูู ุงูุฏุฎูู ุฅูู Paymob

ุงูุชุญ: https://accept.paymob.com/portal2/en/login

ุฃุฏุฎู ุจูุงูุงุช ุญุณุงุจู (ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ).

---

### 2. ุงูุฐูุงุจ ุฅูู Settings

ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุถุบุท ุนูู:
- **Settings** (ุงูุฅุนุฏุงุฏุงุช)
- ุซู **Account Info** ุฃู **API Keys**

---

### 3. ุงูุนุซูุฑ ุนูู API Key

ุณุชุฌุฏ ุนุฏุฉ ููุงุชูุญ:

| ุงูููุน | ุงูุงุณุชุฎุฏุงู | ูุซุงู |
|------|----------|------|
| **API Key** | ูููุตุงุฏูุฉ (ูุฐุง ูุง ูุญุชุงุฌู) | `ZXlKaGJHY2lP...` |
| **Secret Key** | ููุฎูุงุฏู ุงูุฎูููุฉ ููุท | `are_sk_live_...` |
| **Public Key** | ููุชุทุจููุงุช ุงูุฃูุงููุฉ | `are_pk_live_...` |

โ๏ธ **ููู**: ูุญุชุงุฌ **API Key** ููุท (ูููุณ Secret Key ุฃู Public Key)

---

### 4. ุฅุนุงุฏุฉ ุชูููุฏ API Key (ุฅุฐุง ูุฒู ุงูุฃูุฑ)

ุฅุฐุง ูุงู ุงูููุชุงุญ ุงูุญุงูู ูุง ูุนูู:

1. ุงุจุญุซ ุนู ุฒุฑ **"Regenerate API Key"** ุฃู **"Generate New Key"**
2. ุงุถุบุท ุนููู
3. โ๏ธ **ุงูุณุฎ ุงูููุชุงุญ ุงูุฌุฏูุฏ ููุฑุงู** - ูู ุชุชููู ูู ุฑุคูุชู ูุฑุฉ ุฃุฎุฑู

---

### 5. ูุณุฎ API Key

1. ุงููุฑ ุนูู ุฃููููุฉ ุงููุณุฎ ุจุฌุงูุจ API Key
2. ุฃู ุญุฏุฏ ุงููุต ุจุงููุงูู ูุงูุณุฎู (Ctrl+C / Cmd+C)

---

### 6. ุชุญุฏูุซ ุงูููุชุงุญ ูู ุงูุชุทุจูู

ุงูุชุญ ุงูููู: `lib/core/config/api_config.dart`

ุงุจุญุซ ุนู:

```dart
static const String paymobApiKey = String.fromEnvironment(
  'PAYMOB_API_KEY',
  defaultValue: 'YOUR_OLD_KEY_HERE',
);
```

ุงุณุชุจุฏู `YOUR_OLD_KEY_HERE` ุจุงูููุชุงุญ ุงูุฌุฏูุฏ:

```dart
static const String paymobApiKey = String.fromEnvironment(
  'PAYMOB_API_KEY',
  defaultValue: 'ZXlKaGJHY2lPaUpJVXpVeE1p...', // ุงูููุชุงุญ ุงูุฌุฏูุฏ
);
```

---

### 7. ุฅุนุงุฏุฉ ุจูุงุก ุงูุชุทุจูู

ุจุนุฏ ุชุญุฏูุซ API Keyุ ูู ุจุฅุนุงุฏุฉ ุจูุงุก ุงูุชุทุจูู:

```bash
flutter clean
flutter build apk --release
```

---

## ุงูุชุญูู ูู Integration IDs

### Integration IDs ุงููุชููุฑุฉ ุญุงููุงู:

| ID | ุงูุงุณู | ุงูููุน | ุงูุนููุฉ | ุงูุญุงูุฉ |
|----|-------|------|--------|---------|
| 81249 | MIGS-online | Online Card | AED | Live โ |
| 81250 | MIGS-onlineAmex | Online Card (Amex) | AED | Live โ |

---

## ุงูุญุตูู ุนูู Iframe ID

### ูุง ูู Iframe IDุ

Iframe ID ูู ูุนุฑูู ุตูุญุฉ ุงูุฏูุน ุงูุชู ุณูุชู ุนุฑุถูุง ูููุณุชุฎุฏู.

### ุฎุทูุงุช ุงูุญุตูู ุนููู:

1. **ุงุฐูุจ ุฅูู**: https://accept.paymob.com/portal2/en/iframes

2. **ุฅูุดุงุก Iframe ุฌุฏูุฏ**:
   - ุงุถุบุท **"+ Create iFrame"**
   - ุงุฎุชุฑ **Integration** (ูุซู: 81249 - MIGS-online)
   - ุงููุฃ ุงูุจูุงูุงุช ุงููุทููุจุฉ
   - ุงุญูุธ

3. **ูุณุฎ Iframe ID**:
   - ุจุนุฏ ุงูุฅูุดุงุกุ ุณุชุฌุฏ Iframe ID (ูุซู: 12345)
   - ุงูุณุฎู

4. **ุชุญุฏูุซ ุงูููุฏ**:
   ุงูุชุญ `lib/core/config/api_config.dart`:

   ```dart
   static const String paymobIframeId = String.fromEnvironment(
     'PAYMOB_IFRAME_ID',
     defaultValue: '12345', // ุถุน ุงูู ID ููุง
   );
   ```

---

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุนุฏุงุฏ

ุจุนุฏ ุชุญุฏูุซ API Key ู Iframe ID:

1. **ุดุบูู ุงูุชุทุจูู**
2. **ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุงุดุชุฑุงูุงุช**
3. **ุงุฎุชุฑ ุจุงูุฉ ูุงุถุบุท "ุงุดุชุฑู ุงูุขู"**
4. **ุชุญูู ูู ุงูุณุฌูุงุช**:

   ```bash
   adb logcat | grep -i paymob
   ```

   ุฅุฐุง ุฑุฃูุช:
   - โ `Paymob: Auth token received` - ูุฌุญ!
   - โ `Paymob Auth Error: 403` - ุงูููุชุงุญ ูุง ูุฒุงู ุบูุฑ ุตุญูุญ

---

## ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงูุฎุทุฃ: "incorrect credentials"

**ุงูุณุจุจ**: API Key ุบูุฑ ุตุญูุญ ุฃู ููุชูู ุงูุตูุงุญูุฉ

**ุงูุญู**:
1. ุชุฃูุฏ ูู ูุณุฎ API Key ูุงููุงู (ุจุฏูู ูุณุงูุงุช)
2. ุฃุนุฏ ุชูููุฏ API Key ุฌุฏูุฏ ูู ููุญุฉ ุงูุชุญูู
3. ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ููุชุงุญ **Live** ูููุณ **Test**

---

### ุงูุฎุทุฃ: "Integration not found"

**ุงูุณุจุจ**: Integration ID ุบูุฑ ููุฌูุฏ ุฃู ุบูุฑ ูุดุท

**ุงูุญู**:
1. ุชุฃูุฏ ูู Integration ID ุตุญูุญ (81249 ุฃู 81250)
2. ุชุญูู ูู ุฃู Integration ูู ูุถุน **Live**

---

### ุงูุฎุทุฃ: "Iframe not found"

**ุงูุณุจุจ**: Iframe ID ุบูุฑ ุตุญูุญ

**ุงูุญู**:
1. ุงูุดุฆ Iframe ุฌุฏูุฏ ูู ููุญุฉ ุงูุชุญูู
2. ุงุณุชุฎุฏู Iframe ID ุงูุตุญูุญ ูู ุงูููุฏ

---

## ุงูุฏุนู ุงูููู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

1. **ุชูุงุตู ูุน Paymob**:
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: support@paymob.com
   - ุงููุงุชู: (ุญุณุจ ุจูุฏู)

2. **ุชุญูู ูู ุญุงูุฉ ุงูุญุณุงุจ**:
   - ูุฏ ูุญุชุงุฌ ุงูุญุณุงุจ ุชูุนูู ุฅุถุงูู
   - ูุฏ ุชููู ููุงู ูููุฏ ุนูู ุงูุญุณุงุจ

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ุฃูุงู ุงูููุงุชูุญ**:
- ูุง ุชุดุงุฑู API Keys ูุน ุฃุญุฏ
- ูุง ุชุฑูุน ุงูููุงุชูุญ ุฅูู GitHub
- ุงุณุชุฎุฏู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู Production

โ๏ธ **ุงููุถุน ุงูุชุฌุฑูุจู**:
- ุงููุถุน ุงูุชุฌุฑูุจู ูููุนูู ุญุงููุงู ููุชุทููุฑ
- ุชุฐูุฑ ุชุนุทููู ูุจู ุงููุดุฑ ูููุณุชุฎุฏููู
- ูู Productionุ ุงุณุชุฎุฏู Paymob ุงูุญูููู ููุท

---

## ุงูุฎูุงุตุฉ

1. โ **ุงูุญู ุงููุคูุช**: ุงููุถุน ุงูุชุฌุฑูุจู ูุนูู ุญุงููุงู
2. โ๏ธ **ููุฅูุชุงุฌ**: ูุฌุจ ุงูุญุตูู ุนูู API Key ุตุญูุญ
3. ๐ **ุงูุฎุทูุงุช**: ุงุชุจุน ุงูุฏููู ุฃุนูุงู ููุญุตูู ุนูู ุงูููุงุชูุญ

---

**ุขุฎุฑ ุชุญุฏูุซ**: 7 ููููุจุฑ 2025
